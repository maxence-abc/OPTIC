{% extends 'base.html.twig' %}

{% block title %}{{ establishment.name }}{% endblock %}

{% block body %}
<div class="container py-4">

  <div class="d-flex flex-wrap align-items-start justify-content-between gap-3 mb-4">
    <div>
      <h1 class="h3 mb-1">{{ establishment.name }}</h1>
      <div class="text-muted">
        {{ establishment.address }}, {{ establishment.postalCode }} {{ establishment.city }}
      </div>

      <div class="mt-2">
        <a href="{{ path('app_establishment_index') }}">Retour</a>
        <a href="{{ path('app_establishment_edit', {'id': establishment.id}) }}">Modifier</a>
        <a href="{{ path('app_service_new_for_establishment', { id: establishment.id }) }}">Ajouter un service</a>
      </div>
    </div>
  </div>

  {# PHOTOS #}
  {% if establishment.establishmentImages is defined and establishment.establishmentImages|length > 0 %}
    <div class="mb-4">
      <h2 class="h5">Photos</h2>

      <div style="display:flex; gap:12px; flex-wrap:wrap;">
        {% for img in establishment.establishmentImages %}
          <div style="width:220px; aspect-ratio: 4/3; overflow:hidden; border-radius:12px; border:1px solid #e5e5e5;">
            <img
              src="{{ asset('uploads/' ~ img.path) }}"
              alt="Photo {{ establishment.name }}"
              style="width:100%; height:100%; object-fit:cover;"
              loading="lazy"
            >
          </div>
        {% endfor %}
      </div>
    </div>

    <hr class="my-4">
  {% endif %}

  <h2 class="h5 mt-4">À propos</h2>
  {% if establishment.description %}
    <p>{{ establishment.description }}</p>
  {% else %}
    <p class="text-muted">Aucune description.</p>
  {% endif %}

  <hr class="my-4">

  <h2 class="h5">Services proposés</h2>
  <div class="text-muted mb-2">{{ establishment.services|length }}</div>

  {% if establishment.services|length > 0 %}
    <ul>
      {% for service in establishment.services %}
        <li style="margin-bottom: 8px;">
          <strong>{{ service.name }}</strong>
          {% if service.description %}- {{ service.description }}{% endif %}
          — {{ service.duration }} min — {{ service.price }} €
          {% if service.bufferTime %}(+{{ service.bufferTime }} min){% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">Aucun service pour cet établissement.</p>
  {% endif %}

  <hr class="my-4">

  <h2 class="h5">Horaires d’ouverture</h2>

  {% set dayOrder = {
    'Monday': 1,
    'Tuesday': 2,
    'Wednesday': 3,
    'Thursday': 4,
    'Friday': 5,
    'Saturday': 6,
    'Sunday': 7
  } %}

  {% set dayLabel = {
    'Monday': 'Lundi',
    'Tuesday': 'Mardi',
    'Wednesday': 'Mercredi',
    'Thursday': 'Jeudi',
    'Friday': 'Vendredi',
    'Saturday': 'Samedi',
    'Sunday': 'Dimanche'
  } %}

  {% if establishment.openingHours is defined and establishment.openingHours|length > 0 %}
    {% set hours = establishment.openingHours|sort((a,b) => (dayOrder[a.dayOfWeek] ?? 99) <=> (dayOrder[b.dayOfWeek] ?? 99)) %}

    <ul>
      {% for oh in hours %}
        <li style="margin-bottom: 6px;">
          <strong>{{ dayLabel[oh.dayOfWeek] ?? oh.dayOfWeek }}</strong> :
          {{ oh.openTime ? oh.openTime|date('H:i') : '' }}
          -
          {{ oh.closeTime ? oh.closeTime|date('H:i') : '' }}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">Aucun horaire défini pour cet établissement.</p>
  {% endif %}

  <hr class="my-4">

  {{ include('establishment/_delete_form.html.twig') }}

</div>
{% endblock %}
