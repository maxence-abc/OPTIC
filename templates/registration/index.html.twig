{# templates/registration/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Inscription - OPTIC{% endblock %}
{% block body_class %}auth-page{% endblock %}

{% block header %}{% endblock %}

{% block stylesheets %}
  <link rel="stylesheet" href="/css/components/auth.css">
{% endblock %}

{% block body %}

  <twig:AuthCard
    title="Bienvenue sur OPTIC"
    subtitle="Créez un compte pour gérer vos réservations"
    backHref="{{ path('app_home') }}"
    topIcon="uit:calendar"
  >
    <twig:AuthTabs
      active="register"
      loginHref="{{ path('app_login') }}"
      registerHref="{{ path('app_registration') }}"
    />

    {# Flash messages #}
    {% for message in app.flashes('success') %}
      <div class="auth-alert auth-alert--info">{{ message }}</div>
    {% endfor %}
    {% for message in app.flashes('error') %}
      <div class="auth-alert auth-alert--error">{{ message }}</div>
    {% endfor %}

    {{ form_start(form, { attr: { class: 'auth-form' } }) }}

      <div class="auth-field">
        <div class="auth-label">Type de compte</div>

        <div class="auth-account">
          <div class="auth-account__grid">

            <div class="auth-account__item">
              {{ form_widget(form.accountType[0], { attr: { class: 'auth-account__input' } }) }}
              <label for="{{ form.accountType[0].vars.id }}" class="auth-account__card">
                <span class="auth-account__icon">{{ ux_icon('uil:user') }}</span>
                <span class="auth-account__text">Client</span>
              </label>
            </div>

            <div class="auth-account__item">
              {{ form_widget(form.accountType[1], { attr: { class: 'auth-account__input' } }) }}
              <label for="{{ form.accountType[1].vars.id }}" class="auth-account__card">
                <span class="auth-account__icon">{{ ux_icon('uil:store') }}</span>
                <span class="auth-account__text">Professionnel</span>
              </label>
            </div>

          </div>
        </div>

        {{ form_errors(form.accountType) }}
      </div>

      <div class="auth-field">
        <label class="auth-label" for="{{ form.firstName.vars.id }}">Prénom</label>
        <div class="auth-input">
          {{ ux_icon('uil:user') }}
          {{ form_widget(form.firstName, { attr: { placeholder: 'Votre prénom' } }) }}
        </div>
        {{ form_errors(form.firstName) }}
      </div>

      <div class="auth-field">
        <label class="auth-label" for="{{ form.lastName.vars.id }}">Nom</label>
        <div class="auth-input">
          {{ ux_icon('uil:user') }}
          {{ form_widget(form.lastName, { attr: { placeholder: 'Votre nom' } }) }}
        </div>
        {{ form_errors(form.lastName) }}
      </div>

      <div class="auth-field">
        <label class="auth-label" for="{{ form.email.vars.id }}">Email</label>
        <div class="auth-input">
          {{ ux_icon('uil:envelope') }}
          {{ form_widget(form.email, { attr: { placeholder: 'votre.email@exemple.fr' } }) }}
        </div>
        {{ form_errors(form.email) }}
      </div>

      <div class="auth-field">
        <label class="auth-label" for="{{ form.phone.vars.id }}">Téléphone</label>
        <div class="auth-input">
          {{ ux_icon('uil:phone') }}
          {{ form_widget(form.phone, { attr: { placeholder: '06 00 00 00 00' } }) }}
        </div>
        {{ form_errors(form.phone) }}
      </div>

      {# Détection erreurs password (champ composé) #}
      {% set pwHasError =
        (form.password.first.vars.errors|length > 0)
        or (form.password.second.vars.errors|length > 0)
        or (form.password.vars.errors|length > 0)
      %}

      {# MOT DE PASSE #}
      <div class="auth-field">
        <label class="auth-label" for="{{ form.password.first.vars.id }}">Mot de passe</label>
        <div class="auth-input {{ pwHasError ? 'is-error' : '' }}">
          {{ ux_icon('uil:lock') }}
          {{ form_widget(form.password.first, { attr: { placeholder: '..........................' } }) }}
        </div>
      </div>

      {# CONFIRMATION #}
      <div class="auth-field">
        <label class="auth-label" for="{{ form.password.second.vars.id }}">Confirmez le mot de passe</label>
        <div class="auth-input {{ pwHasError ? 'is-error' : '' }}">
          {{ ux_icon('uil:lock') }}
          {{ form_widget(form.password.second, { attr: { placeholder: '..........................' } }) }}
        </div>
      </div>

      {# ERREURS groupées (sous les deux champs) #}
      {% if pwHasError %}
        <div class="auth-error">
          {{ form_errors(form.password) }}
          {{ form_errors(form.password.first) }}
          {{ form_errors(form.password.second) }}
        </div>
      {% endif %}

      {{ form_rest(form) }}

      <twig:Button
        label="Créer mon compte"
        type="submit"
        variant="primary"
        size="lg"
        fullWidth="{{ true }}"
      />

    {{ form_end(form) }}

  </twig:AuthCard>

{% endblock %}
