{% extends 'base.html.twig' %}

{% block title %}Mon compte - OPTIC{% endblock %}
{% block body_class %}page-account{% endblock %}

{% block stylesheets %}
  <link rel="stylesheet" href="/css/pages/account.css">
{% endblock %}

{# Désactive la navbar uniquement sur /account #}
{% block header %}{% endblock %}

{% block body %}

{% set activeTab = app.request.query.get('tab') ?: 'reservations' %}

{# HERO #}
<section class="account-hero">
  <div class="container container--wide account-hero__container">
    <a class="account-hero__back" href="{{ path('app_home') }}">
      <span class="account-hero__back-icon" aria-hidden="true">
        {{ ux_icon('uil:arrow-left') }}
      </span>
      Retour
    </a>


    <div class="account-hero__identity">
      <div class="account-hero__avatar" aria-hidden="true">
        <span class="account-hero__avatar-icon" aria-hidden="true">{{ ux_icon('uil:user') }}</span>
      </div>

      <div class="account-hero__text">
        <div class="account-hero__title">Mon Compte Client</div>
        <div class="account-hero__email">{{ app.user.email }}</div>
      </div>
    </div>
  </div>
</section>

{# CONTENT #}
<section class="account">
  <div class="container container--wide account__container">

    {# TABS (liens, stable) #}
    <div class="account-tabs" role="tablist" aria-label="Onglets compte">

      <a
        class="account-tabs__tab {{ activeTab == 'reservations' ? 'is-active' : '' }}"
        href="{{ path('app_account', { tab: 'reservations' }) }}"
        role="tab"
        aria-selected="{{ activeTab == 'reservations' ? 'true' : 'false' }}"
      >
        <span class="account-tabs__icon" aria-hidden="true">{{ ux_icon('uil:calendar-alt') }}</span>
        Mes réservations
      </a>

      <a
        class="account-tabs__tab {{ activeTab == 'reviews' ? 'is-active' : '' }}"
        href="{{ path('app_account', { tab: 'reviews' }) }}"
        role="tab"
        aria-selected="{{ activeTab == 'reviews' ? 'true' : 'false' }}"
      >
        <span class="account-tabs__icon" aria-hidden="true">{{ ux_icon('uil:star') }}</span>
        Mes avis
      </a>

      <a
        class="account-tabs__tab {{ activeTab == 'profile' ? 'is-active' : '' }}"
        href="{{ path('app_account', { tab: 'profile' }) }}"
        role="tab"
        aria-selected="{{ activeTab == 'profile' ? 'true' : 'false' }}"
      >
        <span class="account-tabs__icon" aria-hidden="true">{{ ux_icon('uil:setting') }}</span>
        Profil
      </a>

    </div>

    {# PANELS #}
    <div class="account-panels">

      {# ===================== RÉSERVATIONS ===================== #}
      {% if activeTab == 'reservations' %}
        <div class="account-panel is-active" role="tabpanel">

          <div class="account-card">
            <div class="account-card__header">
              <h2 class="account-card__title">
                Réservations à venir ({{ upcomingAppointments|default([])|length }})
              </h2>
            </div>

            {% if upcomingAppointments is not defined or upcomingAppointments is empty %}
              <p class="account-muted">Aucune réservation à venir pour le moment.</p>
            {% endif %}
          </div>

          {% if upcomingAppointments is defined and upcomingAppointments is not empty %}
            <div class="reservation-list">
              {% for a in upcomingAppointments %}
                {% include 'account/_reservation_card.html.twig' with { appointment: a } %}
              {% endfor %}
            </div>
          {% endif %}

          <div class="account-card account-card--spaced">
            <div class="account-card__header">
              <h2 class="account-card__title">Historique</h2>
            </div>

            {% if pastAppointments is defined and pastAppointments is not empty %}
              <div class="reservation-list reservation-list--compact">
                {% for a in pastAppointments %}
                  {% include 'account/_reservation_card.html.twig' with { appointment: a, compact: true } %}
                {% endfor %}
              </div>
            {% else %}
              <p class="account-muted">Aucun historique pour le moment.</p>
            {% endif %}
          </div>

        </div>
      {% endif %}

      {# ===================== AVIS ===================== #}
      {% if activeTab == 'reviews' %}
        <div class="account-panel is-active" role="tabpanel">
          <div class="account-card">
            <div class="account-card__header">
              <h2 class="account-card__title">Mes avis</h2>
            </div>
            <p class="account-muted">Fonctionnalité en cours.</p>
          </div>
        </div>
      {% endif %}

      {# ===================== PROFIL ===================== #}
      {% if activeTab == 'profile' %}
        <div class="account-panel is-active" role="tabpanel">

          <div class="account-card">
            <div class="account-card__header account-card__header--withAction">
              <h2 class="account-card__title">Informations personnelles</h2>

              <twig:Button
                label="Modifier"
                href="#"
                variant="outline"
                size="sm"
                iconLeft="uil:edit"
              />
            </div>

            <div class="account-kv">
              <div class="account-kv__row">
                <div class="account-kv__key">Nom complet</div>
                <div class="account-kv__value">{{ app.user.firstName }} {{ app.user.lastName }}</div>
              </div>

              <div class="account-kv__row">
                <div class="account-kv__key">Email</div>
                <div class="account-kv__value">{{ app.user.email }}</div>
              </div>

              <div class="account-kv__row">
                <div class="account-kv__key">Téléphone</div>
                <div class="account-kv__value">{{ app.user.phone ?: '—' }}</div>
              </div>

              <div class="account-kv__row">
                <div class="account-kv__key">Adresse</div>
                <div class="account-kv__value">—</div>
              </div>
            </div>
          </div>

          <div class="account-card">
            <div class="account-card__header">
              <h2 class="account-card__title">Sécurité</h2>
            </div>

            <twig:Button
              label="Changer le mot de passe"
              href="{{ path('app_forgot_password_request') }}"
              variant="outline"
              size="md"
              iconLeft="uil:lock"
            />
          </div>

          <div class="account-card">
            <div class="account-card__header">
              <h2 class="account-card__title">Préférences</h2>
            </div>

            <div class="account-checks">
              <label class="account-check">
                <input type="checkbox">
                <span>Recevoir des notifications par email</span>
              </label>

              <label class="account-check">
                <input type="checkbox">
                <span>Recevoir des offres promotionnelles</span>
              </label>

              <label class="account-check">
                <input type="checkbox">
                <span>Rappels de réservation par SMS</span>
              </label>
            </div>
          </div>

          <div class="account-logout">
            <a class="account-logout__btn" href="{{ path('app_logout') }}">
              <span class="account-logout__icon" aria-hidden="true">{{ ux_icon('uil:signout') }}</span>
              Se déconnecter
            </a>
          </div>

        </div>
      {% endif %}

    </div>
  </div>
</section>

{% endblock %}
